<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo - M√°rcia Hisae</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-form { max-width: 800px; margin: 40px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full-width { grid-column: span 2; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #0B3B71; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #e6eef7; border-radius: 8px; font-size: 14px; }
        .btn-save { background: #0B3B71; color: white; padding: 15px; border: none; border-radius: 8px; width: 100%; font-weight: 700; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .btn-save:hover { background: #D6A528; }
        .muted { font-size: 12px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="admin-form">
            <h2>Cadastrar Novo Im√≥vel</h2>
            <form id="propertyForm">
                <div class="form-grid">
                    <div class="full-width">
                        <label>T√≠tulo do Im√≥vel</label>
                        <input type="text" id="title" placeholder="Ex: Apartamento luxuoso no Centro" required>
                    </div>
                    
                    <div>
                        <label>Tipo</label>
                        <select id="type" onchange="togglePetField()">
                            <option value="venda">Venda</option>
                            <option value="aluguel">Aluguel</option>
                        </select>
                    </div>

                    <div>
                        <label>Pre√ßo</label>
                        <input type="text" id="priceDisplay" placeholder="R$ 0,00" required>
                        <input type="hidden" id="priceRealValue">
                    </div>

                    <div>
                        <label>√Årea</label>
                        <input type="text" id="areaDisplay" placeholder="0 m¬≤" required>
                    </div>

                    <div>
                        <label>Quartos</label>
                        <input type="number" id="bedrooms" placeholder="Ex: 2" required>
                    </div>

                    <div>
                        <label>Vagas</label>
                        <input type="number" id="parking" placeholder="Ex: 1" required>
                    </div>

                    <div>
                        <label>Banheiros</label>
                        <input type="number" id="bathrooms" placeholder="Ex: 2" required>
                    </div>

                    <div id="petFieldWrapper" style="display: none;">
                        <label>Aceita Pet?</label>
                        <select id="pets">
                            <option value="false">N√£o</option>
                            <option value="true">Sim</option>
                        </select>
                    </div>

                    <div class="full-width">
                        <label>Localiza√ß√£o Curta</label>
                        <input type="text" id="shortLocation" placeholder="Ex: S√£o Bernardo do Campo ‚Ä¢ Centro" required>
                    </div>

                    <div class="full-width">
                        <label>Descri√ß√£o Detalhada</label>
                        <textarea id="longDescription" rows="4" placeholder="Descreva os detalhes do im√≥vel..."></textarea>
                    </div>

                    <div class="full-width">
                        <label>Fotos do Im√≥vel (Selecione do Computador)</label>
                        <input type="file" id="fileInput" multiple accept="image/*">
                        <p class="muted">Dica: Segure 'Ctrl' para selecionar v√°rias fotos.</p>
                    </div>
                </div>
                <button type="submit" class="btn-save" id="btnSubmit">Salvar no Banco SQL</button>
            </form>
        </div>
    </div>

<script>
    // 1. Formata√ß√£o de Moeda
    const priceInput = document.getElementById('priceDisplay');
    priceInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value === '') { e.target.value = ''; return; }
        value = (value / 100).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        e.target.value = value;
        document.getElementById('priceRealValue').value = value.replace(/[^\d,]/g, '').replace(',', '.');
    });

    // 2. Formata√ß√£o de √Årea
    const areaInput = document.getElementById('areaDisplay');
    areaInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if(value) e.target.value = value + " m¬≤";
    });

    // 3. Campo de Pet
    function togglePetField() {
        const type = document.getElementById('type').value;
        const wrapper = document.getElementById('petFieldWrapper');
        wrapper.style.display = (type === 'aluguel') ? 'block' : 'none';
    }

    // 4. L√≥gica de Envio √önica
    document.getElementById('propertyForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = e.target.querySelector('button');
        
        const formData = new FormData();
        const files = document.getElementById('fileInput').files;

        if (files.length === 0) {
            alert("M√°rcia, selecione pelo menos uma foto.");
            return;
        }

        for (let i = 0; i < files.length; i++) {
            formData.append('images', files[i]);
        }

        formData.append('title', document.getElementById('title').value);
        formData.append('type', document.getElementById('type').value);
        formData.append('price', document.getElementById('priceRealValue').value);
        formData.append('area', document.getElementById('areaDisplay').value.replace(/\D/g, ''));
        formData.append('bedrooms', document.getElementById('bedrooms').value || 0);
        formData.append('parking', document.getElementById('parking').value || 0);
        formData.append('bathrooms', document.getElementById('bathrooms').value || 0);
        formData.append('shortLocation', document.getElementById('shortLocation').value);
        formData.append('longDescription', document.getElementById('longDescription').value);
        formData.append('pets', document.getElementById('type').value === 'aluguel' ? document.getElementById('pets').value : 'false');

        try {
            btn.innerText = "Enviando...";
            btn.disabled = true;

            const response = await fetch('https://imobiliaria-marcia.onrender.com/api/imoveis', {
                method: 'POST',
                body: formData
            });

            const resultado = await response.json();

            if (response.ok) {
                alert('‚úÖ Sucesso! Im√≥vel cadastrado no SQL.');
                e.target.reset();
                document.getElementById('petFieldWrapper').style.display = 'none';
            } else {
                alert('‚ùå Erro: ' + (resultado.error || 'Erro interno'));
            }
        } catch (err) {
            alert('üöÄ Erro de conex√£o! Verifique se o servidor no Render est√° ativo.');
        } finally {
            btn.innerText = "Salvar no Banco SQL";
            btn.disabled = false;
        }
    });
</script>
</body>
</html>
